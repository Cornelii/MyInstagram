{% extends 'base.html' %}
{% load static %}

{% block body %}

  <div class="row justify-content-center">
  
    {% for post in posts %}
          <div class="card" style="width: 20rem;">
              <div class="card-header">
                <span>{{ post.user.username }}</span>
              </div>
              
              {% if post.image %}
                <img src="{{post.image.url}}" class="card-img-top" alt="...">
              {% else %}
                <img src="https://picsum.photos/200/200/?random" class="card-img-top" alt="...">
              {% endif %}

            
            <div class="card-body">
              <p class="card-text">{{post.content}}</p>
              
              <!-- 작성자만 수정/삭제 가능  -->
              {% if post.user == request.user  %}
                <form method="POST" action = "{% url 'posts:delete' post.id %}" class="d-inline-block">
                  {% csrf_token %}
                  <button class="btn btn-danger">삭제</button>
                </form>
                <a href="{% url 'posts:update' post.id %}" class="btn btn-success">수정</a>
              {% endif%}
            </div>
            <!--좋아요 버튼 추가-->
            <div class="card-body">
              <a href="{% url 'posts:like' post.id %}">
                <!-- 해당유저가 like를 했으면   -->
                {% if user in post.like_users.all %}
                  <i class="fas fa-heart"></i>
                {% else %}
                <!-- 아니면  -->
                  <i class="far fa-heart"></i>
                {% endif %}
              </a>
              <p class="card-text">
                {{post.like_users.count}}명이 좋아합니다.
              </p>
            </div>
            
            {% load bootstrap4 %}
            
            <div class="card-body">
              <!-- ModelForm about comment -->
              
              <form method = "POST" action={% url 'posts:comment_create' post.id %}>
                {% csrf_token  %}
                <!-- bootstrap form  -->
                {% bootstrap_form comment_form  %}
                <button class="btn btn-primary" type="submit">댓글 남기기</button>
                
              </form>
              
              <!-- 해당글에 작성된 댓글을 모두 출력  -->
              {% for com in post.comments.all  %}
                <div class="card-text d-inline">
                  <strong>{{com.user.username}}</strong>: {{com.content}}
                </div>
                <a href="{% url 'posts:comment_delete' post.id com.id %}"><i class="fas fa-trash-alt"></i></a>
                <hr class="m-1 p-0">
                {% empty  %}
                <p>댓글이 없습니다.</p>
                
              {% endfor %}
            
            </div>
            
          </div>
    {% endfor %}
  
  </div>  
  
  <script src={% static 'js/script1.js' %}></script>
{% endblock %}

